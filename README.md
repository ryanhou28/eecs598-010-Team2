# eecs598-010-Team2

# TODO:
- MAC:
  - [ ] Optimize existing designs
  - [ ] 4-bit MAC unit
    - [X] 4-bit Adder
    - [X] 4-bit Multiplier
  - [ ] 8-bit MAC unit
    - [ ] Design 8-bit Adder
    - [ ] Design 8-bit Multiplier
  - [ ] Investigate Dataflow, NoC to use
  - [ ] Investigate Mapping of Weights onto Accelerator

# Helpful Links:
- Project [Google Drive](https://drive.google.com/drive/u/1/folders/1lGD-EbEd5oGc7vOjrX4MHmwefSjBNjo0)
- PyLSE [Github](https://github.com/UCSBarchlab/PyLSE)
- GraphViz [Visualizer](https://dreampuf.github.io/GraphvizOnline/) (Helpful for PyLSE)
- Paper Links:
  - [Superconducting Computing with Alternating Logic Elements](https://ieeexplore.ieee.org/abstract/document/9499888)
  - [Scaling Qubit Readout with Hardware Efficient Machine Learning Architectures](https://arxiv.org/abs/2212.03895)
  - [Deep-Neural-Network Discrimination of Multiplexed Superconducting-Qubit States](https://arxiv.org/abs/2102.12481)
  - [PyLSE: a pulse-transfer level language for superconductor electronics](https://dl.acm.org/doi/abs/10.1145/3519939.3523438)
  - [SuperNPU: An Extremely Fast Neural Processing Unit Using Superconducting Logic Devices](https://ieeexplore.ieee.org/document/9251979)
  - [A Computational Temporal Logic for Superconducting Accelerators](https://dl.acm.org/doi/10.1145/3373376.3378517)
  - [Addressable Superconductor Integrated Circuit Memory from Delay Lines](https://arxiv.org/abs/2205.08016)
  - [ShiDianNao: shifting vision processing closer to the sensor](https://dl.acm.org/doi/10.1145/2749469.2750389)
  - Eyeriss paper

# Synthesis Scripts
Instructions from Panagiotis on synthesis Scripts:

For combinatorial designs you can use aagcomb.sh {file} and for pipelined designs you can use pline.sh {file}.

Because I use ABC for synthesis the input file needs to be in low level structural verilog since the tool cannot parse behavioral verilog. Additionally sequential designs should not have the clock as an input since ABC adds it's own clock. I have attached an example file of that format.

For combinatorial designs the output will be {file}_N.v and for pipelined {file}_MAP.v.

And/Or gates at the resulting files correspond to LastArrival/FirstArrival in xsfq. Each input of the design has a buffer and an inverter to provide complementary signals, and every output has either a buffer or an inverter depending on whether the output has been assigned positive or negative polarity. These buffers/inverters are virtual and are only there to assist in verification, so if the output has an inverter the actual output should be the input of the inverter, which corresponds to the opposite of the output of the original design.

In order for the scripts to run, you will need a recent version of yosys for yosys-abc, the utility aig2aig from https://github.com/arminbiere/aiger, and the pip packages in requirements.txt.

The outputs are single rail, since it is assumed they will be connected to either a complementary output DRO or an alternating signal to single signal converter, and so only one of the polarities of each output is needed and we can reduce duplication costs by not calculating the other.

## Input Requirements
Input verilog file requirements:
- Must be structural verilog
- Remove all comments. The script breaks when it sees comments //
- Module declaration must follow the format like below (separately declare input and output after declaring module name and ports:
    module modName(var1, var2, var3);
      input var1, var2;
      output var3;
- Can’t use genvar, for loops, etc
- Assign statements cannot assign arrays of 

## Environment Setup for Scripts
- Download yosys (via OSS-CAD-SUITE or something else)
- Download and install aiger
- Install python packages in requirements.txt in synthesis_scripts
  - *You might have to manually install ipython from their website if the ipython that pip install gets is having trouble starting up.
  - *If ipython doesn’t work, use my alternative script aagcomb_ryan_ver.sh
  - *NOTE: USE PYTHON 3.10 OR ABOVE
  - *Also might have to pip install dill
  - *I think they forgot to put dill into requirements.txt

# Synthesis Workflow:
- Source oss-cad-suite
  - Run on oss-cad-suite directory: source environment
- Run script “aagcomb.sh {verilog_file_name}”
  - Try aagcomb_ryan_version.sh if you're having trouble with ipython
- Run parser on the module_name_N.v that you generated from the script
- Run the python script generated by the parser

# Behavioral Verilog to PyLSE Workflow:
Note: Currently only supports combinational design. TODO: Support pipelined designs.
- Workflow to convert Behavioral -> Structural -> Synthesis Script -> PyLSE:
- Source oss-cad-suite
- Run yosys script that synthesizes into a netlist full of NAND gates
  - Example in MAC/Adder/adder_8bit_syn.ys. Change the input file name and the top level module name.
- Use nand_to_str.py to convert the netlist of NAND gates to structural verilog
  - This saves a file with the name file_name_structural.v
  - Before this can be used with the synthesis script, check that assign statements in this file doesn't perform vector-signal assignments (eg assign array1[3:0] = array2[3:0]). If there are vector-signal assignments, convert by hand to single wire assignments (eg assign array1[0] = array2[0], etc). TODO: Update nand_to_str.py to do this automatically.
- Use the synthesis script “aagcomb.sh” to synthesize to dual railed netlist
  - This generates a file with the name file_name_structural_N.v
- Use netlistPyLSEParser.py to convert netlist to PyLSE
  - This generates a file with the name file_name_structural_PyLSE.py
- Note that some bits in the output are flipped from the actual output. Check the netlist to see whether the output wires are connected through an inverter or a buffer. Inverter means the PyLSE output bit is flipped, and buffer means the PyLSE output bit is correct.
- The time period in the PyLSE simulation should also be changed.
